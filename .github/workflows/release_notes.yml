name: Release

on:
 workflow_dispatch:

jobs:
  fetch-latest-release-notes:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: View latest release and store release notes
      run: |
        latest_tag=$(gh release list --limit 1 | awk '{print $1}')
        echo $latest_tag
        gh release view $latest_tag --json body | jq -r .body > release_notes.md
      env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  

    - name: Print Release Notes
      run: cat release_notes.md

    - name: Install Pandoc
      run: |
        sudo apt-get update
        sudo apt-get install -y pandoc

    - name: Convert MD to Confluence Markup
      run: |
        pandoc -s release_notes.md -o confluence_markup.txt
        echo test
        cat confluence_markup.txt
    - name: Publish to Confluence
      env:
        CONFLUENCE_API_TOKEN: ${{ secrets.CONFLUENCE_PASSWORD }}
      run: |
        curl -u "jatsingh9696@gmail.com:ATATT3xFfGF0UKmQc20W07Fsk51C1Iqxf2N5NYRZMeOoMMSnHxvAZ9BK1mOr9pPWBZwfaNwW0NnrFPEWAzWMClwh86q6TCzD8ZK-NqJx5NmUKxWnAi4Ff90xH3nJ0h9qNX0PC7PB1MsUXKNoHCEtRcb1Xn-6-sq998V1UWwhxe-84Qo-UP_dwdw=6E175430" -X PUT -H 'Content-Type: application/json' \
        -d '{"version":{"number":your_current_page_version},"title":"Your Page Title","type":"page","body":{"storage":{"value":"$(< confluence_markup.txt)","representation":"storage"}}}' \
        https://jatin-bamel.atlassian.net/wiki/rest/api/content/950287


